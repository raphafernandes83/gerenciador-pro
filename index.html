<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciador de Operações PRO v9.3</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="css/modals.css" />
    <link rel="stylesheet" href="css/cards.css" />
    <link rel="stylesheet" href="css/tables.css" />
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="sidebar.css" />
    <link rel="stylesheet" href="animations.css" />
    <link rel="stylesheet" href="panel-minimize.css" />
    <link rel="stylesheet" href="ui-improvements.css" />
    <link rel="stylesheet" href="parameters-panel-fix.css" />
    <link rel="stylesheet" href="info-panel.css" />
    <link rel="stylesheet" href="info-panel-responsive.css" />
    <link rel="stylesheet" href="hide-green-panel.css" />
    <link rel="stylesheet" href="src/ui/components/help/metric-tooltip.css" />
    <link rel="stylesheet" href="src/ui/components/help/help-fab.css" />
    <link rel="stylesheet" href="fab-unified-style.css" />
    <link rel="stylesheet" href="src/ui/components/notifications.css" />
    <link rel="stylesheet" href="src/validation/validation-styles.css" />
    <link rel="stylesheet" href="css/theme-unified-pro.css" />
    <link rel="manifest" href="manifest.json" />
</head>

<body data-theme="moderno">
    <div id="container" class="container hidden">
        <header class="app-header">
            <div class="app-title-group">
                <div>
                    <p id="trader-name">Nome do Trader</p>
                    <h1>Gerenciador <span class="pro-version">PRO v9.3</span></h1>
                </div>
            </div>
            <div class="header-actions">
                <div id="status-indicators">
                    <button id="session-mode-indicator" class="status-chip session-official"
                        title="Clique para alternar modo">
                        <!-- SVG Activity Icon (Lucide) -->
                        <svg class="chip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                        </svg>
                        <span id="session-mode-label">OFICIAL</span>
                    </button>
                    <button id="strategy-indicator" class="status-chip strategy-normal" title="Tipo de Estratégia">
                        <!-- SVG RefreshCw Icon (Lucide) -->
                        <svg class="chip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 2v6h-6"></path>
                            <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
                            <path d="M3 22v-6h6"></path>
                            <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                        </svg>
                        <span id="strategy-indicator-label">NORMAL</span>
                    </button>
                    <button id="guided-mode-indicator" class="status-chip guided-active" title="Modo Guiado">
                        <!-- SVG Lock Icon (Lucide) -->
                        <svg class="chip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        <span id="guided-mode-label">GUIADO</span>
                    </button>
                    <button id="compounding-indicator" class="status-chip compound-active" title="Juros Compostos">
                        <!-- SVG TrendingUp Icon (Lucide) -->
                        <svg class="chip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                            <polyline points="17 6 23 6 23 12"></polyline>
                        </svg>
                        <span id="compounding-label">ATIVO</span>
                    </button>
                </div>
                <button id="zen-mode-btn" title="Modo Zen" aria-label="Ativar Modo Zen">
                    <svg class="icon md" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                </button>
                <button id="compact-mode-btn" title="Modo Compacto" aria-label="Ativar Modo Compacto">
                    <svg class="icon md" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="4 14 10 14 10 20" />
                        <polyline points="20 10 14 10 14 4" />
                        <line x1="14" y1="10" x2="21" y2="3" />
                        <line x1="3" y1="21" x2="10" y2="14" />
                    </svg>
                </button>
                <button id="settings-btn" title="Configurações" aria-label="Abrir Configurações" aria-expanded="false"
                    aria-controls="settings-modal">
                    <svg class="icon md" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M12 1v6m0 6v6M16.24 7.76l-4.24 4.24m0 0L7.76 16.24M12 1l4.24 6.76M7.76 7.76L12 12m4.24 4.24L12 12" />
                    </svg>
                </button>
                <button id="install-app-btn" class="hidden" title="Instalar App" aria-label="Instalar como aplicativo">
                    <svg class="icon md" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <rect x="5" y="2" width="14" height="20" rx="2" ry="2" />
                        <line x1="12" y1="18" x2="12.01" y2="18" />
                    </svg>
                </button>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-button" data-tab="plano">Plano de Operações</button>
            <button class="tab-button" data-tab="dashboard">Dashboard</button>
            <button class="tab-button" data-tab="diario">Diário</button>
            <button class="tab-button" data-tab="analise">Análise Estratégica</button>
        </nav>

        <div id="meta-aviso"></div>

        <div id="plano-content" class="tab-content">
            <main>
                <section id="main-area">
                    <div id="input-panel" class="input-panel panel"></div>
                    <div class="panel">
                        <div class="panel-header">
                            <h2>Plano de Operações</h2>
                        </div>
                        <div class="overflow-x-auto">
                            <table id="tabela-resultados">
                                <thead>
                                    <tr>
                                        <th>Etapa</th>
                                        <th>Aporte</th>
                                        <th>Valor (R$)</th>
                                        <th>Retorno (R$)</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabela-body"></tbody>
                            </table>
                        </div>
                    </div>



                    <div class="results-panel panel">
                        <div class="panel-header">
                            <h2>Histórico Visual do Dia</h2>
                            <div id="timeline-filters" class="filter-buttons">
                                <button data-filter="all" class="active" aria-label="Mostrar todas as operações">
                                    Tudo
                                </button>
                                <button data-filter="win_streak" aria-label="Mostrar maior sequência de vitórias">
                                    <svg class="icon md" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path
                                            d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" />
                                    </svg>
                                </button>
                                <button data-filter="loss_streak" aria-label="Mostrar maior sequência de derrotas">
                                    <svg class="icon md" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="9" cy="12" r="1" />
                                        <circle cx="15" cy="12" r="1" />
                                        <path d="M8 20v2h8v-2" />
                                        <path d="M12.5 17H11.5" />
                                        <path
                                            d="M12 2C6.5 2 2 6.5 2 12v2c0 1.5.5 3 1.5 4l.5.5V22h16v-3.5l.5-.5c1-1 1.5-2.5 1.5-4v-2c0-5.5-4.5-10-10-10z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div id="timeline-container" class="timeline-container"></div>
                    </div>
                </section>
                <aside id="right-sidebar">
                    <div id="dashboard-area">
                        <div id="performance-panel" class="panel">
                            <h3 id="capital-atual-label">Capital Atual</h3>
                            <p id="capital-atual" class="value"></p>
                            <p id="display-capital-calculo">(Base: R$ 0,00)</p>
                            <hr class="my-15 border-muted" />
                            <h3 id="lucro-prejuizo-label">Resultado do Dia</h3>
                            <p id="lucro-prejuizo" class="value"></p>
                        </div>

                        <!-- ===== PROGRESSO DAS METAS (MOVIDO PARA SIDEBAR) ===== -->
                        <div class="panel progress-metas-panel" id="progress-metas-panel">
                            <div class="panel-header">
                                <h2>📊 Progresso das Metas</h2>
                                <div class="progress-metas-subtitle">
                                    <span>Meta Win/Loss vs. Realizado</span>
                                    <span class="progress-session-info" id="progress-session-info">Sessão
                                        Inativa</span>
                                </div>
                            </div>

                            <!-- Container Principal dos Gráficos (layout com separador central do preview) -->
                            <div class="progress-charts-grid">
                                <!-- Gráfico de Pizza + legenda -->
                                <div class="progress-chart-section progress-pie-section preview-left">
                                    <h3 class="progress-chart-title">Distribuição da Sessão</h3>
                                    <div class="progress-pie-wrapper">
                                        <canvas id="progress-pie-chart" width="220" height="220"
                                            aria-label="Gráfico de distribuição Win/Loss"></canvas>
                                    </div>

                                    <!-- Contadores de Vitórias e Derrotas -->
                                    <div class="win-loss-counters">
                                        <div class="counter-item counter-wins">
                                            <span class="counter-icon">🟢</span>
                                            <span class="counter-value" id="wins-counter">0</span>
                                            <span class="counter-label">Vitórias</span>
                                        </div>
                                        <div class="counter-item counter-losses">
                                            <span class="counter-icon">🔴</span>
                                            <span class="counter-value" id="losses-counter">0</span>
                                            <span class="counter-label">Derrotas</span>
                                        </div>
                                    </div>
                                    <!-- Blocos textuais do preview (lado esquerdo) -->
                                    <div class="grid grid-cols-2 gap-15 mt-10">
                                        <div>
                                            <h4 class="section-title">Meta (R$)</h4>
                                            <div class="text-09 text-muted no-wrap">Alvo: <span
                                                    id="win-target-amount">R$ 0,00</span></div>
                                            <div class="text-09 text-muted no-wrap">Atingido: <span
                                                    id="meta-achieved-amount">R$ 0,00</span></div>
                                        </div>
                                        <div>
                                            <h4 class="section-title">Risco</h4>
                                            <div class="text-09 text-muted no-wrap">Margem: <span id="status-margin">R$
                                                    0,00</span></div>
                                            <div class="text-09 text-muted no-wrap">Risco usado: <span
                                                    id="risk-used-display">0%</span></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Separador vertical refinado -->
                                <div class="preview-separator" aria-hidden="true"></div>

                                <!-- Barras de Progresso Melhoradas -->
                                <div class="progress-chart-section progress-bars-section">
                                    <h3 class="progress-chart-title">Metas vs. Performance</h3>
                                    <div class="progress-bars-grid">
                                        <!-- Win Rate Bar -->
                                        <div class="progress-bar-container">

                                            <div class="progress-bar-track" id="win-main-track">
                                                <div class="progress-bar-background"></div>
                                                <div class="progress-bar-target" id="win-target-bar"
                                                    title="Meta Win Rate"></div>
                                                <div class="progress-bar-current progress-bar-win" id="win-current-bar"
                                                    title="Win Rate Atual"></div>
                                            </div>
                                            <div class="progress-bar-info">
                                                <span class="progress-target">Meta (WR):
                                                    <span id="win-target-value">60%</span><span id="meta-target-percent"
                                                        class="hidden"></span></span>
                                                <span class="progress-current">WR Atual:
                                                    <span id="win-current-value">0%</span><span
                                                        id="meta-current-percent" class="hidden"></span>
                                                    <span id="meta-trend-badge" class="trend-badge"></span></span>
                                            </div>
                                            <div class="progress-amount-info">
                                                <span class="progress-target-amount">Meta:
                                                    <span id="win-target-amount">R$ 0,00</span><span
                                                        id="meta-target-amount" class="hidden"></span></span>
                                                <span class="progress-remaining-amount">Atingido:
                                                    <span id="win-remaining-amount">R$ 0,00</span><span
                                                        id="meta-achieved-amount" class="hidden">R$ 0,00</span></span>
                                            </div>
                                            <!-- Mini barra: Progresso da Meta -->
                                            <div class="mini-progress" id="meta-progress-area">
                                                <div class="progress-bar-track" id="meta-progress-track">
                                                    <div class="progress-bar-current progress-bar-win"
                                                        id="meta-progress-fill" title="Progresso da Meta"></div>
                                                </div>
                                                <div class="progress-bar-info">
                                                    <span>Progresso da Meta:
                                                        <span id="meta-progress-display">0%</span></span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Loss Rate Bar -->
                                        <div class="progress-bar-container">

                                            <div class="progress-bar-track" id="loss-main-track">
                                                <div class="progress-bar-background"></div>
                                                <div class="progress-bar-target" id="loss-target-bar"
                                                    title="Meta Loss Rate"></div>
                                                <div class="progress-bar-current progress-bar-loss"
                                                    id="loss-current-bar" title="Loss Rate Atual"></div>
                                            </div>
                                            <div class="progress-bar-info">
                                                <span class="progress-target">Limite (%):
                                                    <span id="loss-target-value">40%</span><span
                                                        id="loss-target-percent" class="hidden"></span></span>
                                                <span class="progress-current">Loss Atual:
                                                    <span id="loss-current-value">0%</span><span
                                                        id="loss-current-percent" class="hidden"></span>
                                                    <span id="loss-trend-badge" class="trend-badge"></span></span>
                                            </div>
                                            <div class="progress-amount-info">
                                                <span class="progress-limit-amount">Limite (R$):
                                                    <span id="loss-limit-amount">R$ 0,00</span></span>
                                                <span class="progress-session-result">P/L Sessão (R$):
                                                    <span id="loss-session-result">R$ 0,00</span></span>
                                            </div>
                                            <!-- Mini barra: Risco Utilizado -->
                                            <div class="mini-progress" id="risk-used-area">
                                                <div class="progress-bar-track" id="risk-used-track">
                                                    <div class="progress-bar-current progress-bar-loss"
                                                        id="risk-used-fill" title="Risco Utilizado"></div>
                                                </div>
                                                <div class="progress-bar-info">
                                                    <span>Risco Usado: <span class="risk-used-secondary">0%</span> <span
                                                            id="risk-used-value" class="hidden">0%</span></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Bloco de métricas no formato do preview -->
                                    <div class="preview-metrics">
                                        <h3 class="section-title">Performance</h3>
                                        <ul class="metric-list" role="list">
                                            <li class="metric-row"><span class="metric-label">Meta</span><span
                                                    class="metric-value" id="meta-target-amount-panel">R$
                                                    1.000,00</span></li>
                                            <li class="metric-row"><span class="metric-label">Atingido</span><span
                                                    class="metric-value" id="meta-achieved-amount-panel">R$ 0,00</span>
                                            </li>
                                            <li class="metric-row"><span class="metric-label">Progresso da
                                                    Meta</span><span class="metric-value"
                                                    id="meta-progress-value-panel">0%</span></li>
                                        </ul>

                                        <h3 class="section-title mt-15">Risco</h3>
                                        <ul class="metric-list" role="list">
                                            <li class="metric-row"><span class="metric-label">Limite (R$)</span><span
                                                    class="metric-value" id="loss-limit-amount-panel">R$ 0,00</span>
                                            </li>
                                            <li class="metric-row"><span class="metric-label">P/L Sessão
                                                    (R$)</span><span class="metric-value"
                                                    id="loss-session-result-panel">R$ 0,00</span></li>
                                            <li class="metric-row"><span class="metric-label">Risco Usado</span><span
                                                    class="metric-value" id="risk-used-value-panel">0%</span></li>
                                        </ul>
                                    </div>
                                </div>

                            </div>

                            <!-- Indicadores de Status Melhorados -->
                            <div class="progress-status-grid">
                                <div class="progress-status-card" id="win-status-indicator">
                                    <div class="status-icon">
                                        <span class="status-emoji">🎯</span>
                                    </div>
                                    <div class="status-content">
                                        <span class="status-text">Vamos começar!</span>
                                        <small class="status-subtext">Win Rate</small>
                                    </div>
                                </div>
                                <div class="progress-status-card" id="loss-status-indicator">
                                    <div class="status-icon">
                                        <span class="status-emoji">âœ…</span>
                                    </div>
                                    <div class="status-content">
                                        <span class="status-text">Controle total</span>
                                        <small class="status-subtext">Loss Rate</small>
                                    </div>
                                </div>
                                <!-- Badge opcional para lock suave (visível apenas quando sinalizado) -->
                                <span id="progress-soft-lock-badge" class="badge muted hidden"
                                    aria-live="polite"></span>
                                <!-- Linhas de status financeiras (compatíveis com preview) -->
                                <span id="status-target-amount" class="hidden">R$ 0,00</span>
                                <span id="status-achieved" class="hidden">R$ 0,00</span>
                                <span id="status-exceed" class="hidden">R$ 0,00</span>
                                <span id="status-margin" class="hidden">R$ 0,00</span>
                                <span id="status-risk-used" class="hidden">0%</span>
                            </div>
                        </div>

                        <div id="mental-note-panel" class="panel insight-panel hidden">
                            <div class="panel-header mb-05">
                                <h3 id="mental-note-title">Diagnóstico do Dia</h3>
                            </div>
                            <p id="mental-note-text"></p>
                        </div>
                        <div id="session-controls" class="action-buttons">
                            <button id="undo-btn" title="Desfaz a última operação registrada">
                                Desfazer
                            </button>
                            <button id="finish-session-btn">Finalizar Sessão</button>
                            <button id="new-session-btn" class="hidden">Nova Sessão</button>
                        </div>
                    </div>
                </aside>

            </main>
        </div>

        <div id="dashboard-content" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h3>Filtros de Performance</h3>
                </div>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label>Período de Análise</label>
                        <div id="dashboard-period-filters" class="filter-buttons">
                            <button data-period="7">Últimos 7 Dias</button>
                            <button data-period="30">Últimos 30 Dias</button>
                            <button data-period="month">Este Mês</button>
                            <button data-period="all" class="active">Todo o Período</button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Modo de Sessão</label>
                        <div id="dashboard-mode-filters" class="filter-buttons">
                            <button data-mode="all" class="active">Todas</button>
                            <button data-mode="oficial">Oficial</button>
                            <button data-mode="simulacao">Simulação</button>
                        </div>
                    </div>
                </div>
            </div>
            <main>
                <section id="dashboard-main-grid">
                    <div class="panel">
                        <div class="panel-header">
                            <h3 id="dashboard-stats-title">Estatísticas (Todo o Período)</h3>
                            <div id="dashboard-summary"></div>
                        </div>
                        <div id="dashboard-stats-grid" class="stats-grid"></div>
                        <div class="action-buttons mt-15 grid-cols-2">
                            <button id="open-lab-btn">Laboratório de Risco</button>
                            <button id="generate-pdf-btn">Gerar Relatório PDF</button>
                        </div>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Diagnóstico por Tag (Período)</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table id="dashboard-tag-diagnostics-table">
                                <thead>
                                    <tr>
                                        <th>Tag</th>
                                        <th>Nº Ops</th>
                                        <th>Assertividade</th>
                                        <th>Resultado</th>
                                    </tr>
                                </thead>
                                <tbody id="dashboard-tag-diagnostics-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
                <aside id="dashboard-charts-area" class="flex flex-col gap-15">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Assertividade (Período)</h3>
                        </div>
                        <div class="pos-rel h-220 mx-auto">
                            <canvas id="dashboard-assertividade-chart"></canvas>
                        </div>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Curva de Património (Período)</h3>
                        </div>
                        <div class="pos-rel h-220 mx-auto">
                            <canvas id="dashboard-patrimonio-chart"></canvas>
                        </div>
                    </div>
                </aside>
            </main>
        </div>

        <div id="diario-content" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2>Histórico de Sessões</h2>
                    <div id="diario-filter-buttons" class="filter-buttons">
                        <button class="active" data-filter="todas">Todas</button>
                        <button data-filter="oficial">Oficial</button>
                        <button data-filter="simulacao">Simulação</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table id="tabela-historico-sessoes">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Modo</th>
                                <th>Resultado</th>
                                <th>Nº Ops</th>
                                <th>Assertividade</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-historico-body"></tbody>
                    </table>
                </div>
            </div>
        </div>


        <div id="analise-content" class="tab-content">
            <div class="panel">
                <p class="text-muted text-center italic">
                    A análise abaixo utiliza os filtros de <strong>Período</strong> e
                    <strong>Modo de Sessão</strong> definidos na aba <strong>Dashboard</strong>.
                </p>
            </div>
            <div class="analysis-section panel" id="analise-desempenho">
                <div class="panel-header">
                    <h2>Análise de Desempenho Multi-dimensional</h2>
                </div>
                <div class="input-group max-w-350 mb-20">
                    <label for="analise-dimension-select">Analisar Performance Por:</label>
                    <div class="flex-row-center-gap-8">
                        <select id="analise-dimension-select" class="flex-1">
                            <option value="dayOfWeek">Dia da Semana</option>
                            <option value="hourOfDay">Hora do Dia</option>
                            <option value="tag">Tag de Operação</option>
                            <option value="payout">Faixa de Payout</option>
                        </select>
                        <button class="help-icon" data-metric="analise-dimensao-selector" data-value="selector"
                            aria-label="Ajuda sobre Dimensões de Análise" title="Clique para mais informações">
                            <svg class="icon sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" />
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                                <line x1="12" y1="17" x2="12.01" y2="17" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <h3 class="h3-flex-row-mb-12">
                        Resultados por Categoria
                        <button class="help-icon" data-metric="analise-tabela-categoria" data-value="table"
                            aria-label="Ajuda sobre Tabela de Resultados" title="Clique para mais informações">
                            <svg class="icon sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" />
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                                <line x1="12" y1="17" x2="12.01" y2="17" />
                            </svg>
                        </button>
                    </h3>
                    <table id="analise-results-table">
                        <thead id="analise-results-head"></thead>
                        <tbody id="analise-results-body"></tbody>
                    </table>
                </div>
                <div class="insight-panel hidden mt-15" id="analise-insight-panel">
                    <h3 id="analise-insight-title">Diagnóstico Quantitativo</h3>
                    <p id="analise-insight-text" class="italic text-muted"></p>
                </div>
            </div>
            <div class="analysis-section panel" id="goal-optimizer-panel">
                <div class="panel-header">
                    <h2>Otimizador de Metas e Risco</h2>
                </div>
                <p class="text-muted mb-15">
                    Testo diferentes metas e Stop Loss com base no seu histórico de
                    operações (usando os filtros do Dashboard) para encontrar a configuração
                    ideal de Risco/Retorno. <br /><strong class="text-info">É recomendado um histórico de pelo menos
                        20
                        operações para uma
                        simulação mais confiável.</strong>
                </p>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="optimizer-stop-win">Simular Meta (%)</label>
                        <input type="number" id="optimizer-stop-win" value="10" min="0" max="100" step="0.1" />
                    </div>
                    <div class="input-group">
                        <label for="optimizer-stop-loss">Simular Stop Loss (%)</label>
                        <input type="number" id="optimizer-stop-loss" value="15" min="0" max="100" step="0.1" />
                    </div>
                </div>
                <div class="modal-actions mb-15 grid-cols-1">
                    <button id="run-goal-simulation-btn" class="modal-action-btn bg-accent">
                        Simular Cenário
                    </button>
                </div>
                <div id="goal-simulation-results" class="hidden">
                    <hr />
                    <div class="stats-grid grid-cols-2 gap-15">
                        <div class="stat-card">
                            <h4>Resultado Simulado</h4>
                            <p id="goal-sim-result"></p>
                        </div>
                        <div class="stat-card">
                            <h4>Risco/Retorno</h4>
                            <p id="goal-sim-rr"></p>
                        </div>
                        <div class="stat-card">
                            <h4>Sessões de Win</h4>
                            <p id="goal-sim-wins" class="positive"></p>
                        </div>
                        <div class="stat-card">
                            <h4>Sessões de Loss</h4>
                            <p id="goal-sim-losses" class="negative"></p>
                        </div>
                    </div>
                    <p id="goal-simulation-insight"></p>
                </div>
            </div>
            <div class="analysis-section panel" id="capital-curve-panel">
                <div class="panel-header">
                    <h2>Diagnóstico da Curva de Capital</h2>
                    <button id="run-capital-curve-analysis-btn" class="modal-action-btn bg-info w-auto p-btn">
                        Analisar Curva
                    </button>
                </div>
                <p class="text-muted mb-15">
                    Esta ferramenta analisa a sequência das suas operações para identificar os
                    seus maiores períodos de perda (Drawdown) e de ganho (Pico de Performance),
                    ajudando-o a entender a volatilidade da sua estratégia.
                </p>
                <div id="capital-curve-results" class="hidden">
                    <hr />
                    <div class="stats-grid grid-cols-2 gap-15">
                        <div class="stat-card">
                            <h4>📉 Maior Drawdown</h4>
                            <p id="curve-max-drawdown" class="negative"></p>
                            <span id="curve-drawdown-duration" class="text-08 text-muted"></span>
                        </div>
                        <div class="stat-card">
                            <h4>📈 Maior Pico</h4>
                            <p id="curve-max-peak" class="positive"></p>
                            <span id="curve-peak-duration" class="text-08 text-muted"></span>
                        </div>
                    </div>
                    <p id="capital-curve-insight" class="insight-panel mt-15 p-10"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="session-mode-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Iniciar Nova Sessão</h2>
            <p>
                Selecione o modo para a sua próxima sessão de trading. Esta escolha será
                registada no seu diário.
            </p>
            <div class="options">
                <button class="checklist-option" id="start-official-session-btn">
                    <span class="text-15 lh-1">📈</span>
                    <span class="block mt-05">Sessão Oficial</span>
                </button>
                <button class="checklist-option" id="start-simulation-session-btn">
                    <span class="text-15 lh-1">🧪</span>
                    <span class="block mt-05">Sessão de Simulação</span>
                </button>
            </div>
        </div>
    </div>

    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-title"></h2>
            <p id="modal-message"></p>
            <div class="modal-actions">
                <button id="modal-cancel-btn" class="modal-action-btn">Cancelar</button>
                <button id="modal-confirm-btn" class="modal-action-btn">Confirmar</button>
            </div>
        </div>
    </div>

    <div id="tags-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="tags-modal-title">Classifique sua operação:</h3>
            <div id="tags-container" class="tags-container"></div>
            <div class="input-group">
                <label for="op-note" class="mt-10">Notas (Opcional):</label>
                <textarea id="op-note" placeholder="Ex: Entrei atrasado, notícia impactou..."></textarea>
            </div>
            <div class="modal-actions mt-10">
                <button id="skip-tag-btn" class="modal-action-btn bg-info">
                    Registar Sem Tag
                </button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay" role="dialog" aria-modal="true"
        aria-labelledby="settings-modal-title" aria-hidden="true">
        <div class="modal-content">
            <h2 id="settings-modal-title">Configurações</h2>
            <nav class="settings-tabs">
                <button class="settings-tab-button tab-button active" data-tab="settings-gerenciamento">
                    📊 Gerenciamento
                </button>
                <button class="settings-tab-button tab-button" data-tab="settings-perfil">
                    👤 Perfil
                </button>
                <button class="settings-tab-button tab-button" data-tab="settings-aparencia">
                    🎨 Aparência
                </button>
                <button class="settings-tab-button tab-button" data-tab="settings-preferencias">
                    ⚙️ Preferências
                </button>
            </nav>
            <div id="settings-gerenciamento-content" class="settings-tab-content active">
                <h3>Gerenciamento</h3>
                <div class="flex-row justify-between mb-10">
                    <span class="tooltip-container">
                        <label for="modal-modo-guiado-toggle">Modo Guiado</label>
                        <i class="tooltip-icon">i<span class="tooltip-text">Trava as operações, permitindo registrar
                                resultados apenas na
                                etapa atual do plano.</span></i>
                    </span>
                    <label class="switch"><input type="checkbox" id="modal-modo-guiado-toggle" checked /><span
                            class="slider"></span></label>
                </div>
                <div class="flex-row justify-between mb-10">
                    <span class="tooltip-container">
                        <label for="modal-incorporar-lucro-toggle">Incorporar Lucros</label>
                        <i class="tooltip-icon">i<span class="tooltip-text">Soma automaticamente o lucro de ciclos
                                vencedores ao capital,
                                recalculando os próximos aportes (juros compostos).</span></i>
                    </span>
                    <label class="switch"><input type="checkbox" id="modal-incorporar-lucro-toggle" /><span
                            class="slider"></span></label>
                </div>
                <div class="flex-row justify-between mb-10">
                    <span class="tooltip-container">
                        <label for="auto-lock-toggle">Bloqueio Automático</label>
                        <i class="tooltip-icon">i<span class="tooltip-text">Bloqueia o app por um tempo após atingir a
                                meta de ganho ou
                                perda.</span></i>
                    </span>
                    <label class="switch"><input type="checkbox" id="auto-lock-toggle" /><span
                            class="slider"></span></label>
                </div>
                <div id="lock-duration-container" class="input-group hidden mt-10">
                    <label for="lock-duration-select">Duração do Bloqueio</label>
                    <select id="lock-duration-select">
                        <option value="8">8 Horas</option>
                        <option value="12">12 Horas</option>
                        <option value="16">16 Horas</option>
                        <option value="20">20 Horas</option>
                    </select>
                </div>
                <hr class="my-15 border-muted" />
                <div id="divisor-recuperacao-group">
                    <h3>Estratégia de Recuperação</h3>
                    <div class="input-group mt-10">
                        <div class="tooltip-container mb-05">
                            <label for="divisor-recuperacao-slider">Divisão de Recuperação (Aporte 1 / Aporte
                                2)</label>
                            <i class="tooltip-icon">?<span class="tooltip-text">Defina a agressividade da sua
                                    recuperação. Isto ajusta a
                                    percentagem do prejuízo que cada um dos dois aportes de
                                    recuperação tentará cobrir.</span></i>
                        </div>
                        <div class="slider-control-group">
                            <button class="slider-btn" id="recovery-slider-minus">-</button>
                            <input type="range" min="10" max="90" value="35" id="divisor-recuperacao-slider"
                                aria-label="Divisor de Recuperação" class="w-full" step="1" />
                            <button class="slider-btn" id="recovery-slider-plus">+</button>
                        </div>
                        <div id="divisor-recuperacao-valor" class="slider-value-display">
                            <span>35%</span> / <span>65%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="settings-perfil-content" class="settings-tab-content">
                <h3>Perfil do Trader</h3>
                <div class="input-group">
                    <label for="trader-name-input">Seu Nome</label><input type="text" id="trader-name-input"
                        placeholder="Digite seu nome ou apelido" />
                </div>
            </div>
            <div id="settings-aparencia-content" class="settings-tab-content">
                <h3>Temas</h3>
                <div class="theme-selector" id="modal-theme-selector">
                    <div class="theme-card" data-theme="moderno">
                        <div class="theme-preview">
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                        </div>
                        <p>Moderno</p>
                    </div>
                    <div class="theme-card" data-theme="claro">
                        <div class="theme-preview">
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                        </div>
                        <p>Claro</p>
                    </div>
                    <div class="theme-card" data-theme="matrix">
                        <div class="theme-preview">
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                        </div>
                        <p>Matrix</p>
                    </div>
                    <div class="theme-card" data-theme="daltonismo">
                        <div class="theme-preview">
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                        </div>
                        <p>Contraste</p>
                    </div>
                    <div class="theme-card" data-theme="unified-pro">
                        <div class="theme-preview unified-pro-preview">
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                            <div class="theme-preview-col"></div>
                        </div>
                        <p>Unified Pro</p>
                    </div>
                </div>
            </div>
            <div id="settings-preferencias-content" class="settings-tab-content">
                <h3>Preferências Gerais</h3>
                <div class="flex-row justify-between mb-10">
                    <label for="modal-notifications-toggle">Notificações de Insight</label><label class="switch"><input
                            type="checkbox" id="modal-notifications-toggle" checked /><span
                            class="slider"></span></label>
                </div>
            </div>
            <div class="modal-actions">
                <button id="close-settings-btn" class="modal-action-btn bg-primary">
                    Fechar e Aplicar
                </button>
            </div>
        </div>
    </div>

    <div id="replay-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="replay-title">Replay da Sessão</h2>
            <div id="replay-dashboard" class="grid-2-1 gap-15 mt-15">
                <div id="replay-left-col" class="flex flex-col gap-15">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Estatísticas da Sessão</h3>
                        </div>
                        <div id="replay-stats-grid" class="stats-grid"></div>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Histórico Visual da Sessão</h3>
                        </div>
                        <div id="replay-timeline-container" class="timeline-container"></div>
                    </div>
                </div>
                <div id="replay-right-col" class="flex flex-col gap-15">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Assertividade</h3>
                        </div>
                        <div class="pos-rel h-200 mx-auto">
                            <canvas id="replayAssertividadeChart"></canvas>
                        </div>
                    </div>
                    <div class="panel">
                        <div class="panel-header">
                            <h3>Curva de Património</h3>
                        </div>
                        <div class="pos-rel h-200 mx-auto">
                            <canvas id="replayPatrimonioChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button id="close-replay-btn" class="modal-action-btn bg-primary">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <div id="insight-popup">
        <p id="insight-popup-text"></p>
    </div>

    <div id="lockdown-overlay" class="hidden">
        <h2>Metas Atingidas!</h2>
        <p>
            A disciplina é a sua maior aliada. A aplicação está bloqueada para proteger o seu
            capital e a sua mente. Volte mais tarde.
        </p>
        <div id="countdown-timer">00:00:00</div>
    </div>

    <div id="risk-lab-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>ðŸ”¬ Laboratório de Risco (Monte Carlo)</h2>
            <p>
                Simule milhares de dias de trading com a sua gestão e estatísticas atuais para
                analisar a robustez da sua estratégia a longo prazo.
            </p>
            <div class="input-grid">
                <div class="input-group">
                    <label>Taxa de Acerto (W) da Sessão</label>
                    <input type="text" id="sim-winrate" disabled
                        title="Valor calculado automaticamente com base nas operações do período" />
                </div>
                <div class="input-group">
                    <label>Payout Médio (P) da Sessão</label>
                    <input type="text" id="sim-payout" disabled
                        title="Valor calculado automaticamente com base nas operações do período" />
                </div>
            </div>
            <div class="input-grid">
                <div class="input-group">
                    <label for="sim-num-simulations">Nº de Simulações</label>
                    <select id="sim-num-simulations">
                        <option value="1000">1.000</option>
                        <option value="5000">5.000</option>
                        <option value="10000">10.000</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="sim-max-ops">Máx. Operações / Dia</label>
                    <input type="number" id="sim-max-ops" value="50" min="1" max="1000" />
                </div>
            </div>
            <div class="modal-actions mb-15 grid-cols-1">
                <button id="run-simulation-btn" class="modal-action-btn bg-accent">
                    Executar Simulação
                </button>
            </div>
            <div id="simulation-progress-container" class="hidden">
                <label>A simular...</label>
                <div class="progress-bar-container h-12 mt-05">
                    <div id="simulation-progress-bar" class="progress-bar-fill bg-info"></div>
                </div>
            </div>
            <div id="simulation-results" class="hidden">
                <hr />
                <div class="stats-grid grid-cols-2 gap-15">
                    <div class="stat-card">
                        <h4>Prob. Atingir Stop Win</h4>
                        <p id="sim-prob-win" class="positive"></p>
                    </div>
                    <div class="stat-card">
                        <h4>Prob. Atingir Stop Loss</h4>
                        <p id="sim-prob-loss" class="negative"></p>
                    </div>
                    <div class="stat-card">
                        <h4>Resultado Médio</h4>
                        <p id="sim-avg-result"></p>
                    </div>
                    <div class="stat-card">
                        <h4>Drawdown Máximo</h4>
                        <p id="sim-max-drawdown" class="negative"></p>
                    </div>
                </div>
                <p id="simulation-insight"></p>
            </div>
            <div class="modal-actions">
                <button id="close-lab-btn" class="modal-action-btn bg-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Seção de Testes Automáticos -->
    <div id="testes-content" class="tab-content">
        <div class="panel">
            <div class="panel-header">
                <h2>🧪 Testes Automáticos</h2>
                <p class="text-muted mt-05">
                    Sistema de testes para verificar a integridade e funcionamento de todos os
                    módulos
                </p>
            </div>
            <div class="test-controls">
                <button id="run-all-tests" class="btn btn-primary">
                    🚀 Executar Todos os Testes
                </button>
                <button id="run-logic-tests" class="btn btn-secondary">
                    🧮 Testes de Lógica
                </button>
                <button id="run-ui-tests" class="btn btn-secondary">
                    🎨 Testes de Interface
                </button>
                <button id="run-db-tests" class="btn btn-secondary">ðŸ’¾ Testes de Banco</button>
                <button id="run-simulation-tests" class="btn btn-secondary">
                    🎲 Testes de Simulação
                </button>
            </div>
            <div id="test-results" class="test-results"></div>
        </div>
    </div>



    <!-- 🗑️ SISTEMA DE LIXEIRA PROFISSIONAL - ETAPAS 1, 2, 3, 4 & 5 -->
    <script type="module" src="src/trash/TrashManager.js"></script>
    <script type="module" src="src/trash/TrashFAB.js"></script>
    <script type="module" src="src/trash/TrashModal.js"></script>
    <script type="module" src="src/trash/TagsTrashHandler.js"></script>
    <script type="module" src="src/trash/OperationsTrashHandler.js"></script>
    <script type="module" src="src/trash/SessionsTrashHandler.js"></script>

    <!-- 📊 PAINEL INFORMATIVO -->
    <script type="module" src="src/ui/InfoPanel.js"></script>
    <script type="module" src="add-info-panel.js"></script>
    <script type="module" src="tests/test-dom-recursion.js"></script>
    <script type="module" src="utils/GoalsUtils.js"></script>

    <!-- âœ… APP LIMPO PARA TRADER - SEM MÃ“DULOS ADMINISTRATIVOS -->

    <!-- 🎯 Funcionalidades Úteis para o Trader -->
    <script type="module" src="src/trader/TraderAssistant.js"></script>

    <script type="module" src="progress-card-calculator.js"></script>
    <script type="module" src="progress-card-updater.js"></script>
    <script type="module" src="progress-card-monetary.js"></script>
    <script type="module" src="progress-card-cache.js"></script>
    <script type="module" src="src/validation/validation-integration.js"></script>
    <script src="error-handler.js"></script>

    <script type="module" src="main.js"></script>
    <script type="module" src="sidebar.js"></script>



    <!-- Arquivos test-simple.js e test-all-components.js movidos para testes-inuteis/ -->
    <!-- Novos testes específicos de sincronização -->
    <script src="tests/test-capital-sync.js"></script>
    <script src="tests/test-stopwin-sync.js"></script>
    <script src="tests/test-stopwin-display.js"></script>
    <script src="tests/test-stoploss-sync.js"></script>
    <script src="tests/test-stoploss-display.js"></script>
    <script src="tests/test-sidebar-new-session-btn.js"></script>

    <!-- 🛡️ SISTEMA DE MONITORAMENTO INTELIGENTE -->
    <script type="module" src="src/monitoring/SmartMonitor.js"></script>
    <script type="module" src="src/monitoring/ErrorBoundary.js"></script>
    <script type="module" src="src/testing/AutomatedTestSuite.js"></script>

    <!-- Sistema SafeProtection removido (CSP) -->
    <!-- ðŸ” TESTES DE CORES E GRÃFICOS REMOVIDOS -->
    <!-- Arquivos movidos para testes-inuteis/ para evitar spam e problemas de performance -->
    <!-- Use teste-restauracao-limpo.js para testes limpos -->

    <!-- 🎨 LAYOUTS ALTERNATIVOS PARA CENTRO DO GRÃFICO -->
    <script src="layouts-centro-grafico.js"></script>


    <!-- ðŸ§  SISTEMA UNIFICADO DE GRÃFICOS - ARQUITETURA LENDÃRIA -->
    <script type="module" src="src/charts/UnifiedChartSystem.js"></script>
    <script type="module" src="src/charts/MigrationManager.js"></script>

    <!-- Plugins do Sistema Unificado -->
    <script type="module" src="src/charts/plugins/PerformanceMonitorPlugin.js"></script>
    <script type="module" src="src/charts/plugins/DataValidationPlugin.js"></script>
    <script type="module" src="src/charts/plugins/StateObserverPlugin.js"></script>

    <!-- Sistema Legado (será migrado gradualmente) -->
    <script src="enhanced-donut-chart-system.js"></script>

    <!-- 🧪 Sistema de Testes Completo -->
    <script type="module" src="src/charts/tests/UnifiedChartSystemTests.js"></script>


    <script type="module" src="install-prompt.js"></script>
    <!-- Service Worker registrado via boot.js (CSP compliant) -->
    <!-- Help System Components -->
    <script src="src/ui/components/help/glossary-data.js"></script>
    <script type="module" src="src/ui/components/help/MetricTooltipManager.js"></script>
    <script type="module" src="src/ui/components/help/HelpFAB.js"></script>
    <script type="module" src="src/ui/components/help/AnalysisHelpIcons.js"></script>
    <script type="module" src="src/ui/components/help/ModalsHelpIcons.js"></script>
    <!-- Boot.js: Inicialização CSP-compliant (substitui scripts inline) -->
    <script src="src/dev/CrashRadar.js"></script>
    <script src="src/init/boot.js"></script>
    <script src="src/ui/components/help/DashboardHelpIcons.js"></script>
    <script src="fab-dock-manager.js"></script>

</body>

</html>